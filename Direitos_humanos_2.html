<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Quiz: Os Superpoderes dos Direitos Humanos</title>
    <style>
        /* --- ESTILOS GERAIS --- */
        :root {
            --cor-primaria: #007BFF;
            --cor-secundaria: #28a745;
            --cor-erro: #dc3545;
            --cor-fundo: #f0f2f5;
            --cor-card: #ffffff;
            --cor-texto: #333333;
            --sombra-card: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Verdana', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 700px;
            background-color: var(--cor-card);
            border-radius: 15px;
            box-shadow: var(--sombra-card);
            padding: 25px;
            margin-bottom: 40px;
            overflow: hidden; /* Previne scroll duplo */
        }

        /* --- CABE√áALHO --- */
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        .header h1 {
            color: var(--cor-primaria);
            font-size: 1.5em;
            margin: 0 0 10px 0;
        }

        .progress-container {
            background-color: #e9ecef;
            border-radius: 10px;
            height: 10px;
            margin-top: 10px;
            overflow: hidden;
        }

        #time-progress {
            height: 100%;
            width: 100%;
            background-color: var(--cor-secundaria);
            transition: width 1s linear;
        }

        #timer-display {
            font-weight: bold;
            color: #666;
            font-size: 1.1em;
            margin-top: 5px;
        }

        /* --- PERGUNTAS E OP√á√ïES --- */
        .question-card {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-text {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Estilo das Op√ß√µes (Radio e Checkbox) */
        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1em;
            box-sizing: border-box; /* Garante que padding n√£o aumenta largura */
        }

        .option-btn:hover {
            background-color: #f8f9fa;
            border-color: var(--cor-primaria);
        }

        .option-btn.selected {
            background-color: #e6f2ff;
            border-color: var(--cor-primaria);
            color: var(--cor-primaria);
            font-weight: bold;
        }

        /* Inputs de Texto */
        .input-text {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            box-sizing: border-box;
        }
        .input-text:focus {
            border-color: var(--cor-primaria);
            outline: none;
        }

        /* Ranking (Ordena√ß√£o) */
        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        .ranking-controls button {
            background: var(--cor-primaria);
            color: white;
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            font-size: 1.2em;
            cursor: pointer;
            margin-left: 5px;
        }
        .ranking-controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Correspond√™ncia (Matching) */
        .matching-row {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .matching-row label { margin-bottom: 5px; font-weight: bold; }
        .matching-row select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }

        /* --- BOT√ÉO DE NAVEGA√á√ÉO --- */
        .nav-area {
            margin-top: 25px;
            text-align: center;
        }
        
        .btn-action {
            background-color: var(--cor-primaria);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-action:hover {
            background-color: #0056b3;
            transform: scale(1.02);
        }
        .btn-finish {
            background-color: var(--cor-secundaria);
        }

        /* --- TELA DE RESULTADOS --- */
        .score-card {
            text-align: center;
            padding: 20px;
            background: #e8f5e9;
            border: 2px solid var(--cor-secundaria);
            border-radius: 10px;
            margin-bottom: 25px;
        }
        .score-number {
            font-size: 3em;
            font-weight: bold;
            color: var(--cor-secundaria);
            display: block;
        }

        .feedback-block {
            border: 1px solid #dee2e6;
            border-left: 5px solid #ccc;
            background: #fff;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            text-align: left;
        }
        .feedback-block.correct { border-left-color: var(--cor-secundaria); }
        .feedback-block.incorrect { border-left-color: var(--cor-erro); }
        
        .status-badge {
            float: right;
            font-size: 1.5em;
        }

        .user-response { font-weight: bold; color: #333; }
        .correct-response { color: var(--cor-secundaria); font-weight: bold; display: block; margin-top: 5px; }
        .explanation { font-style: italic; color: #555; margin-top: 10px; font-size: 0.9em; border-top: 1px dashed #eee; padding-top: 5px; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üåç Quiz: Direitos Humanos</h1>
        <div id="timer-display">Tempo: 10:00</div>
        <div class="progress-container"><div id="time-progress"></div></div>
    </div>

    <div id="start-screen" style="text-align: center; padding: 20px;">
        <h2>Bem-vindo!</h2>
        <p>Tens 20 perguntas para testar os teus conhecimentos sobre a Declara√ß√£o Universal dos Direitos Humanos.</p>
        <p><strong>4.¬∫ Ano | 20 Perguntas | 5 Pontos cada</strong></p>
        <br>
        <p style="font-size: 0.9em; color: #666;">(As perguntas e op√ß√µes ser√£o baralhadas a cada tentativa!)</p>
        <br>
        <button type="button" class="btn-action" onclick="initQuiz()">Come√ßar Agora üöÄ</button>
    </div>

    <div id="quiz-screen" style="display: none;">
        <div style="text-align: right; font-size: 0.9em; color: #888; margin-bottom: 10px;">
            Pergunta <span id="q-current">1</span> de <span id="q-total">20</span>
        </div>
        <div id="question-render-area">
            </div>
        <div class="nav-area">
            <button type="button" id="btn-next" class="btn-action" onclick="nextQuestion()">Pr√≥xima ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="results-screen" style="display: none;">
        </div>
</div>

<script>
    /* --- BANCO DE DADOS ORIGINAL (IMUT√ÅVEL) --- */
    const originalDbQuestions = [
        {
            type: "radio",
            question: "Quem tem Direitos Humanos? (Artigo 1.¬∫)",
            options: ["S√≥ os adultos e os chefes de Estado.", "S√≥ quem vive em pa√≠ses ricos.", "**Todas as pessoas do mundo, desde que nascem.**", "S√≥ os pol√≠ticos."],
            answer: "**Todas as pessoas do mundo, desde que nascem.**",
            explanation: "Os Direitos Humanos s√£o universais. Todos nascem livres e iguais.",
            points: 5
        },
        {
            type: "short",
            question: "Qual √© a sigla da Organiza√ß√£o das Na√ß√µes Unidas? (3 letras)",
            answer: "ONU",
            explanation: "A ONU (Organiza√ß√£o das Na√ß√µes Unidas) criou a Declara√ß√£o em 1948.",
            points: 5
        },
        {
            type: "radio",
            question: "O direito de ires √† escola e aprenderes coisas novas chama-se... (Artigo 26.¬∫)",
            options: ["Direito ao Lazer.", "Direito √† Sa√∫de.", "**Direito √† Educa√ß√£o.**", "Direito √† Fam√≠lia."],
            answer: "**Direito √† Educa√ß√£o.**",
            explanation: "O Direito √† Educa√ß√£o deve ser gratuito e para todos.",
            points: 5
        },
        {
            type: "short",
            question: "A Declara√ß√£o Universal dos Direitos Humanos foi proclamada no ano de...",
            answer: "1948",
            explanation: "Foi criada em 1948, logo a seguir √† Segunda Guerra Mundial.",
            points: 5
        },
        {
            type: "checkbox",
            question: "Quais destes s√£o direitos que te protegem na tua vida em casa e na rua? (Escolhe 2 respostas)",
            options: ["Direito de voar como um p√°ssaro.", "**Direito a ter comida e uma casa segura.**", "**Direito de me expressar (falar) livremente.**", "Direito de ser invis√≠vel."],
            answer: ["**Direito a ter comida e uma casa segura.**", "**Direito de me expressar (falar) livremente.**"],
            explanation: "Alimenta√ß√£o, habita√ß√£o e liberdade de express√£o s√£o fundamentais.",
            points: 5
        },
        {
            type: "radio",
            question: "O que garante o Artigo 3.¬∫ da DUDH?",
            options: ["Direito a ter um carro.", "**Direito √† Vida, √† Liberdade e √† Seguran√ßa Pessoal.**", "Direito a f√©rias eternas.", "Direito a comer doces todos os dias."],
            answer: "**Direito √† Vida, √† Liberdade e √† Seguran√ßa Pessoal.**",
            explanation: "O direito √† vida e √† seguran√ßa pessoal √© o mais b√°sico de todos.",
            points: 5
        },
        {
            type: "ranking",
            question: "Ordena estes 3 direitos pelo grau de import√¢ncia para viveres na escola (1.¬∫ mais importante, 3.¬∫ menos importante para a escola). Usa as setas:",
            items: ["Direito ao Lazer (brincar)", "Direito a comer doces", "Direito √† Educa√ß√£o"],
            answer: ["Direito √† Educa√ß√£o", "Direito ao Lazer (brincar)", "Direito a comer doces"],
            explanation: "Na escola, a prioridade √© a Educa√ß√£o, seguida do Lazer saud√°vel.",
            points: 5
        },
        {
            type: "radio",
            question: "Segundo a DUDH, podemos tratar as pessoas de maneira diferente por causa da cor da sua pele ou religi√£o?",
            options: ["Sim, se o seu pa√≠s for pequeno.", "**N√£o, todos s√£o iguais perante a lei (Artigo 7.¬∫).**", "Sim, se o professor concordar.", "Depende do dia da semana."],
            answer: "**N√£o, todos s√£o iguais perante a lei (Artigo 7.¬∫).**",
            explanation: "O Artigo 7.¬∫ diz que todos somos iguais perante a lei, sem discrimina√ß√£o.",
            points: 5
        },
        {
            type: "matching",
            question: "Liga o Direito ao seu significado:",
            pairs: {"Direito ao Lazer": "Ter tempo para brincar e descansar.", "Direito √† Sa√∫de": "Receber tratamento m√©dico quando se est√° doente.", "Direito de Opini√£o": "Dizer o que se pensa (com respeito)."},
            explanation: "Cada direito protege uma parte importante da nossa vida.",
            points: 5
        },
        {
            type: "radio",
            question: "Ter Direitos significa que s√≥ podemos receber coisas? (Artigo 29.¬∫)",
            options: ["Sim, s√≥ temos direitos.", "**N√£o, tamb√©m temos deveres e responsabilidades para com a nossa comunidade.**", "Sim, os direitos s√£o ilimitados.", "S√≥ temos deveres."],
            answer: "**N√£o, tamb√©m temos deveres e responsabilidades para com a nossa comunidade.**",
            explanation: "Se temos o direito √† educa√ß√£o, temos o dever de estudar e respeitar os professores. Direitos v√™m com responsabilidades!",
            points: 5
        },
        {
            type: "gap",
            question: "A DUDH diz que ningu√©m pode ser mantido em _______________ ou em escravatura. (Artigo 4.¬∫)",
            answer: "servid√£o",
            explanation: "A escravatura e a servid√£o (ser for√ßado a trabalhar para outra pessoa sem liberdade) s√£o proibidas e consideradas crimes contra a humanidade.",
            points: 5
        },
        {
            type: "short",
            question: "O Secret√°rio-Geral da ONU, Ant√≥nio Guterres, ajudou muitas pessoas que fugiam das suas casas como Alto Comiss√°rio. Que nome damos a estas pessoas que fogem do perigo?",
            answer: "Refugiados",
            explanation: "Ant√≥nio Guterres foi Alto Comiss√°rio da ONU para os Refugiados (ACNUR), que s√£o pessoas que tiveram de sair do seu pa√≠s por causa de guerra, viol√™ncia ou persegui√ß√£o.",
            points: 5
        },
        {
            type: "radio",
            question: "Quantos artigos (regras) principais tem a Declara√ß√£o Universal dos Direitos Humanos?",
            options: ["10 artigos", "**30 artigos**", "50 artigos", "100 artigos"],
            answer: "**30 artigos**",
            explanation: "A Declara√ß√£o tem um total de 30 artigos que cobrem os direitos civis, pol√≠ticos, sociais, econ√≥micos e culturais.",
            points: 5
        },
        {
            type: "checkbox",
            question: "A Liberdade de Pensamento (Art. 18.¬∫) permite-te: (Escolhe 2 respostas)",
            options: ["**Ter a tua pr√≥pria religi√£o ou f√© (ou n√£o ter nenhuma).**", "**Mudar de ideias sobre as coisas.**", "Obrigar os outros a pensar como tu.", "Voar at√© √† Lua."],
            answer: ["**Ter a tua pr√≥pria religi√£o ou f√© (ou n√£o ter nenhuma).**", "**Mudar de ideias sobre as coisas.**"],
            explanation: "A liberdade de pensamento protege a tua mente e a tua consci√™ncia. Ningu√©m te pode for√ßar a acreditar em algo que n√£o queres.",
            points: 5
        },
        {
            type: "gap",
            question: "Todos temos o direito de ser ouvidos de forma justa e _______________ por um tribunal, se formos acusados de algo. (Artigo 10.¬∫)",
            answer: "p√∫blica",
            explanation: "O direito a um julgamento justo e p√∫blico √© uma regra para garantir que a justi√ßa √© feita de forma correta e transparente para todos.",
            points: 5
        },
        {
            type: "radio",
            question: "O que significa o Artigo 23.¬∫ sobre o trabalho?",
            options: ["Toda a gente √© obrigada a trabalhar na mesma f√°brica.", "**O direito de escolher livremente o trabalho e ser pago de forma justa.**", "S√≥ os homens podem trabalhar.", "S√≥ se pode trabalhar a partir dos 30 anos."],
            answer: "**O direito de escolher livremente o trabalho e ser pago de forma justa.**",
            explanation: "Quando fores adulto, podes escolher a tua profiss√£o e o teu sal√°rio deve ser o mesmo que o de outra pessoa que fa√ßa o mesmo trabalho, sem discrimina√ß√£o.",
            points: 5
        },
        {
            type: "matching",
            question: "Liga a figura ao cargo que ocupa/ocupou:",
            pairs: {"Eleanor Roosevelt": "Presidente da Comiss√£o que redigiu a DUDH.", "Ant√≥nio Guterres": "Secret√°rio-Geral da ONU.", "Tu": "Cidad√£o"},
            explanation: "Eleanor Roosevelt liderou a comiss√£o da DUDH. Ant√≥nio Guterres √© o atual l√≠der da ONU. E tu √©s um cidad√£o do mundo!",
            points: 5
        },
        {
            type: "checkbox",
            question: "O que garante o Direito √† Fam√≠lia? (Escolhe 2 respostas)",
            options: ["**Poder casar e formar fam√≠lia.**", "**A prote√ß√£o da sociedade e do Estado √† fam√≠lia.**", "Viver sozinho sempre.", "N√£o poder sair de casa nunca mais."],
            answer: ["**Poder casar e formar fam√≠lia.**", "**A prote√ß√£o da sociedade e do Estado √† fam√≠lia.**"],
            explanation: "A fam√≠lia √© o n√∫cleo fundamental da sociedade e deve ser protegida por lei. As pessoas adultas devem ser livres de se casar e formar a sua fam√≠lia.",
            points: 5
        },
        {
            type: "short",
            question: "Os Direitos Humanos s√£o o melhor crit√©rio para resolver ___________, pois garantem justi√ßa e respeito. (Uma palavra no plural)",
            answer: "conflitos",
            explanation: "Como vimos, os Direitos Humanos d√£o as regras para resolver conflitos, garantindo que ningu√©m perde os seus direitos essenciais.",
            points: 5
        },
        {
            type: "radio",
            question: "A DUDH √© v√°lida onde?",
            options: ["S√≥ na Europa.", "**√â v√°lida em todo o lado e para todas as pessoas, sempre.**", "S√≥ na escola.", "Na Lua."],
            answer: "**√â v√°lida em todo o lado e para todas as pessoas, sempre.**",
            explanation: "A Declara√ß√£o √© Universal, o que significa que se aplica a todos, em todos os momentos e em todos os lugares. √â uma lei mundial de respeito!",
            points: 5
        }
    ];

    /* --- ESTADO DO JOGO --- */
    let dbQuestions = []; // Vai receber as perguntas baralhadas
    let currentIndex = 0;
    let userAnswers = [];
    let timerInterval;
    let timeRemaining = 600; // 10 minutos

    /* --- FUN√á√ÉO DE SHUFFLE (BARALHAR) --- */
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    /* --- INICIALIZA√á√ÉO --- */
    function initQuiz() {
        // 1. Cria uma c√≥pia profunda (Deep Copy) das perguntas originais para n√£o afetar o banco original
        dbQuestions = JSON.parse(JSON.stringify(originalDbQuestions));
        
        // 2. Baralha a ordem das perguntas
        shuffleArray(dbQuestions);

        // 3. Baralha as op√ß√µes dentro de cada pergunta
        dbQuestions.forEach(q => {
            if (q.type === 'radio' || q.type === 'checkbox') {
                shuffleArray(q.options);
            }
            // Nas de ranking, baralhamos os items para o utilizador ordenar
            if (q.type === 'ranking') {
                shuffleArray(q.items);
            }
        });

        // Inicializa array de respostas
        userAnswers = new Array(dbQuestions.length).fill(null);
        
        // Reset do UI
        currentIndex = 0;
        timeRemaining = 600;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('results-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('q-total').innerText = dbQuestions.length;
        
        renderQuestion();
        startTimer();
    }

    /* --- RENDERIZA√á√ÉO DA PERGUNTA --- */
    function renderQuestion() {
        const q = dbQuestions[currentIndex];
        const area = document.getElementById('question-render-area');
        document.getElementById('q-current').innerText = currentIndex + 1;
        
        area.innerHTML = ''; // Limpa √°rea anterior
        
        // T√≠tulo
        const title = document.createElement('h3');
        title.className = 'question-text';
        title.innerText = `${currentIndex + 1}. ${q.question.replace('_______________', '______')}`;
        area.appendChild(title);

        // Op√ß√µes baseadas no tipo
        const savedAns = userAnswers[currentIndex];

        if (q.type === 'radio') {
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'option-btn';
                if (savedAns && savedAns[0] === opt) btn.classList.add('selected');
                btn.innerText = cleanText(opt);
                btn.onclick = () => {
                    // Limpa sele√ß√£o visual
                    Array.from(area.querySelectorAll('.option-btn')).forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    userAnswers[currentIndex] = [opt];
                };
                area.appendChild(btn);
            });
        } 
        else if (q.type === 'checkbox') {
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'option-btn';
                // Verifica se j√° estava selecionado
                if (savedAns && savedAns.includes(opt)) btn.classList.add('selected');
                btn.innerText = cleanText(opt);
                btn.onclick = () => {
                    btn.classList.toggle('selected');
                    // Reconstr√≥i array de respostas
                    const allSelected = Array.from(area.querySelectorAll('.selected')).map(b => {
                        // Encontra a op√ß√£o original correspondente ao texto do bot√£o
                        return q.options.find(o => cleanText(o) === b.innerText);
                    });
                    userAnswers[currentIndex] = allSelected;
                };
                area.appendChild(btn);
            });
        }
        else if (q.type === 'short' || q.type === 'gap') {
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'input-text';
            input.placeholder = 'Escreve a tua resposta...';
            if (savedAns) input.value = savedAns[0];
            input.oninput = (e) => userAnswers[currentIndex] = [e.target.value];
            area.appendChild(input);
        }
        else if (q.type === 'ranking') {
            // Se j√° respondeu, usa a ordem guardada. Se n√£o, usa os items (que j√° foram baralhados no initQuiz)
            let currentOrder = savedAns ? [...savedAns] : [...q.items];
            // Garante que guardamos a ordem inicial se for a primeira vez
            if (!savedAns) userAnswers[currentIndex] = [...currentOrder];

            const listContainer = document.createElement('div');
            listContainer.id = 'ranking-list';

            const renderList = () => {
                listContainer.innerHTML = '';
                currentOrder.forEach((item, idx) => {
                    const row = document.createElement('div');
                    row.className = 'ranking-item';
                    row.innerHTML = `<span>${item}</span>`;
                    
                    const controls = document.createElement('div');
                    controls.className = 'ranking-controls';
                    
                    const upBtn = document.createElement('button');
                    upBtn.type = 'button';
                    upBtn.innerText = '‚¨ÜÔ∏è';
                    upBtn.disabled = idx === 0;
                    upBtn.onclick = () => {
                        // Troca com o anterior
                        [currentOrder[idx - 1], currentOrder[idx]] = [currentOrder[idx], currentOrder[idx - 1]];
                        userAnswers[currentIndex] = currentOrder;
                        renderList();
                    };

                    const downBtn = document.createElement('button');
                    downBtn.type = 'button';
                    downBtn.innerText = '‚¨áÔ∏è';
                    downBtn.disabled = idx === currentOrder.length - 1;
                    downBtn.onclick = () => {
                        // Troca com o pr√≥ximo
                        [currentOrder[idx + 1], currentOrder[idx]] = [currentOrder[idx], currentOrder[idx + 1]];
                        userAnswers[currentIndex] = currentOrder;
                        renderList();
                    };

                    controls.appendChild(upBtn);
                    controls.appendChild(downBtn);
                    row.appendChild(controls);
                    listContainer.appendChild(row);
                });
            };
            renderList();
            area.appendChild(listContainer);
        }
        else if (q.type === 'matching') {
            const keys = Object.keys(q.pairs);
            // Os valores s√£o baralhados aqui na hora de renderizar para criar o desafio
            // Nota: A fun√ß√£o de shuffleArray n√£o √© usada aqui para preservar a l√≥gica original de Object.values
            const values = Object.values(q.pairs).sort(() => Math.random() - 0.5); 
            
            // Inicializa objeto se vazio
            if (!userAnswers[currentIndex]) userAnswers[currentIndex] = [{}];
            const currentPairAns = userAnswers[currentIndex][0];

            keys.forEach((key, i) => {
                const row = document.createElement('div');
                row.className = 'matching-row';
                
                const label = document.createElement('label');
                label.innerText = key + ' corresponde a:';
                
                const select = document.createElement('select');
                select.innerHTML = '<option value="">-- Seleciona --</option>';
                values.forEach(val => {
                    const opt = document.createElement('option');
                    opt.value = val;
                    opt.innerText = val;
                    if (currentPairAns[key] === val) opt.selected = true;
                    select.appendChild(opt);
                });

                select.onchange = (e) => {
                    userAnswers[currentIndex][0][key] = e.target.value;
                };

                row.appendChild(label);
                row.appendChild(select);
                area.appendChild(row);
            });
        }

        // Atualiza bot√£o
        const btnNext = document.getElementById('btn-next');
        if (currentIndex === dbQuestions.length - 1) {
            btnNext.innerText = "Terminar e Ver Notas üèÜ";
            btnNext.classList.add('btn-finish');
        } else {
            btnNext.innerText = "Pr√≥xima ‚û°Ô∏è";
            btnNext.classList.remove('btn-finish');
        }
    }

    /* --- NAVEGA√á√ÉO --- */
    function nextQuestion() {
        if (currentIndex < dbQuestions.length - 1) {
            currentIndex++;
            renderQuestion();
        } else {
            calculateAndShowResults();
        }
    }

    /* --- UTILIT√ÅRIOS --- */
    function cleanText(txt) {
        return txt.replace(/\*\*/g, '');
    }

    function normalize(val) {
        if (typeof val === 'string') return val.trim().toLowerCase().replace(/\*\*/g, '');
        return val;
    }

    function startTimer() {
        clearInterval(timerInterval); // Limpa intervalo anterior se existir
        const display = document.getElementById('timer-display');
        const progress = document.getElementById('time-progress');
        const totalTime = 600;

        timerInterval = setInterval(() => {
            timeRemaining--;
            
            const m = Math.floor(timeRemaining / 60);
            const s = timeRemaining % 60;
            display.innerText = `Tempo: ${m}:${s < 10 ? '0'+s : s}`;
            
            progress.style.width = (timeRemaining / totalTime * 100) + '%';

            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                calculateAndShowResults();
            }
        }, 1000);
    }

    /* --- C√ÅLCULO DE RESULTADOS (CR√çTICO) --- */
    function calculateAndShowResults() {
        clearInterval(timerInterval); // Para o tempo
        document.getElementById('quiz-screen').style.display = 'none';
        
        let score = 0;
        let feedbackHTML = '';

        // Itera sobre TODAS as perguntas (mesmo as n√£o respondidas)
        for (let i = 0; i < dbQuestions.length; i++) {
            const q = dbQuestions[i];
            const uAns = userAnswers[i]; // Pode ser null
            let isCorrect = false;

            // L√≥gica de Valida√ß√£o
            try {
                if (uAns) {
                    // 1. Radio, Short, Gap
                    if (['radio', 'short', 'gap'].includes(q.type)) {
                        if (normalize(uAns[0]) === normalize(q.answer)) isCorrect = true;
                    }
                    // 2. Checkbox
                    else if (q.type === 'checkbox') {
                        // Compara arrays ordenados de strings normalizadas
                        const uStr = uAns.map(normalize).sort().join('|');
                        const aStr = q.answer.map(normalize).sort().join('|');
                        if (uStr === aStr && uStr.length > 0) isCorrect = true;
                    }
                    // 3. Ranking
                    else if (q.type === 'ranking') {
                        // Arrays t√™m de ser iguais na ordem
                        if (JSON.stringify(uAns) === JSON.stringify(q.answer)) isCorrect = true;
                    }
                    // 4. Matching
                    else if (q.type === 'matching') {
                        let allMatch = true;
                        const uObj = uAns[0];
                        // Verifica se todas as chaves batem certo
                        for (let key in q.pairs) {
                            if (uObj[key] !== q.pairs[key]) allMatch = false;
                        }
                        // Verifica se respondeu a tudo
                        if (Object.keys(uObj).length < Object.keys(q.pairs).length) allMatch = false;
                        
                        if (allMatch) isCorrect = true;
                    }
                }
            } catch (e) {
                console.error("Erro a validar pergunta " + i, e);
                isCorrect = false;
            }

            if (isCorrect) score += q.points;

            // Preparar Texto para Exibi√ß√£o
            let userDisplay = "Sem resposta";
            if (uAns) {
                if (q.type === 'matching') {
                    userDisplay = Object.entries(uAns[0])
                        .filter(([k,v]) => v !== "")
                        .map(([k,v]) => `${k} ‚ûî ${v}`).join(' | ');
                } else if (q.type === 'ranking') {
                    userDisplay = uAns.join(' ‚ûî ');
                } else {
                    // Filtra itens vazios e junta
                    userDisplay = uAns.map(cleanText).filter(x => x).join(', ');
                }
            }
            if (userDisplay === "") userDisplay = "Sem resposta";

            let correctDisplay = "";
            if (q.type === 'matching') correctDisplay = Object.entries(q.pairs).map(([k,v]) => `${k} ‚ûî ${v}`).join(' | ');
            else if (q.type === 'ranking') correctDisplay = q.answer.join(' ‚ûî ');
            else if (Array.isArray(q.answer)) correctDisplay = q.answer.map(cleanText).join(', ');
            else correctDisplay = cleanText(q.answer);

            // HTML do bloco de feedback
            feedbackHTML += `
                <div class="feedback-block ${isCorrect ? 'correct' : 'incorrect'}">
                    <span class="status-badge">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                    <p><strong>${i + 1}. ${q.question.replace('_______________', '...')}</strong></p>
                    
                    <p>A tua resposta: <span class="user-response" style="color: ${isCorrect ? 'green' : 'red'}">${userDisplay}</span></p>
                    
                    ${!isCorrect ? `<span class="correct-response">Resposta Certa: ${correctDisplay}</span>` : ''}
                    
                    <div class="explanation">üí° ${q.explanation}</div>
                </div>
            `;
        }

        // Injetar no DOM
        const resultsScreen = document.getElementById('results-screen');
        resultsScreen.innerHTML = `
            <div class="score-card">
                <h2>Quiz Terminado!</h2>
                <p>Pontua√ß√£o Final:</p>
                <span class="score-number">${score} / ${dbQuestions.length * 5}</span>
            </div>
            <h3>Revis√£o Detalhada:</h3>
            ${feedbackHTML}
            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn-action" onclick="initQuiz()">Tentar Novamente üîÑ</button>
            </div>
        `;
        
        resultsScreen.style.display = 'block';
        window.scrollTo(0, 0);
    }

</script>

</body>
</html>